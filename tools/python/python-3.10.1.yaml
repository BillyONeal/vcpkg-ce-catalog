# metadata for python
info:
  id: tools/languages/python
  version: 3.10.1
  priority: 10

demands:
  windows and x64:
    unless:  # look for a system installed version first
      from: [$host.PATH, $host.ProgramFiles/*python* ,c:/python]                      # paths to search
      where: [ python.exe,py3.exe, python3.exe,  py.exe  ]        # one of these choices
      run: $0 --version                                              # run the choice with this cmdline
      select: /Python (3.8|3.9|3.\d\d+)\.\d*/g                        # parse the output with this regex
      is: "$1 == '3.10'"                                                # this expression must be true.

      # if all this succeeds, then the rest of this node will be used as the artifact
      # substituting in $0 for the full path of the item that matches.
      message: using discovered python $0
      
      exports: # if this is successful, these are the settings.
        paths:
          path: 
            - "{$0/..}" # adds the found folder to the path
        
        aliases:
          python: "{$0/../python.exe}"
          venv: "{$0} -m venv "

    # if we don't get a match, then we process the artifact as normal
    # 
    error: |
      This requires python (> 3.8.*) installed at the system level. 
      You should download a copy of python and install it and ensure it is in
      the path. 

      Installing:
        Using WinGet:
          `winget install python`
        
        Using chocolatey:
          `choco install python3`

        Manually install:
          Download the file https://python.org/.../python-3.10.0.exe 
          and run it.

  linux:
    unless: 
      from: $host.PATH
      where: python, py, python3, py3 
      run: $0 --version 
      matches: /Python 3\.(8|9|1\d+)\.\d+/g
      is: "$1 < '3.8'"

      exports:
        paths:
          path: $0/.. 
        tools:
          python: $
          venv: -m venv

    error: |
      This requires python installed at the system level.
      You should download a copy of python and install it and ensure it is in
      the path. 

      Ubuntu:
        sudo apt-get python3 
   