# metadata for git
info:
  id: system/git
  version: 2.0.0
  priority: 20

demands:
  windows and x64:
    unless:  # look for a system-installed version first
      from: [$host.Path, $host.ProgramFiles/git/** ]            # paths to search
      where:  git.exe                                       # one of these choices
      run: '"$0" --version'                                           # run the choice with this cmdline
      select: /git version (\d+)/ig                    # parse the output with this regex
      is: "'2' === $1"                                          # this expression must be true.

      # if all this succeeds, then the rest of this node will be used as the artifact
      # substituting in $0 for the full path of the item that matches.
      message: using discovered git $0
      
      settings: # if this is successful, these are the settings.
        paths:
          path: $0/.. # adds the found folder to the path
        
        tools:
          git: $0
     

    # if we don't get a match, then we process the artifact as normal
    # 
    error: |
      This requires git 2 or higher installed 

  linux:
    unless: 
      from: $host.PATH
      where: git
      run: $0 --version 
      select: /git version (\d+)/ig
      is: "'2' === $1"

      settings:
        paths:
          path: $0/.. 
        tools:
          git: $0

    error: |
      This requires git 2 or higher installed.
